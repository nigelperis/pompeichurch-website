---
import HoverableLink from "~/components/ui/hoverable-link.astro";
import ShareLink from "~/components/ui/share-link.astro";
import WhatsAppShare from "~/components/ui/whatsapp-share.tsx";
import { getLangFromUrl, useTranslations } from "~/i18n/utils";
import NetworkImage from "~/components/ui/network-image.astro";


const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

export interface Props {
  title: string;
  imageUrl: string;
  imageWidth?: number;
  imageHeight?: number;
  fileUrl?: string | null;
  featured?: boolean;
  latest?: boolean;
  specialEdition?: boolean;
}

const {
  title,
  imageUrl,
  imageWidth = 600,
  imageHeight = 400,
  fileUrl,
  latest = false,
  specialEdition = false,
} = Astro.props as Props;

const hasFile = Boolean(fileUrl);
const badgeLabel = latest
  ? t("magazine.latest")
  : specialEdition
  ? t("magazine.centenary")
  : null;
const badgeClasses =
  "absolute top-2 right-2 bg-slate-900/70 text-white text-[13px] font-bold px-4 py-1 uppercase tracking-wide";
---

<div class="flex flex-col border border-gray-200">
  <div class="relative w-full">
    <NetworkImage
      src={imageUrl}
      alt={title}
      width={imageWidth}
      height={imageHeight}
      class="w-full object-cover aspect-[2/3]"
    />
    {badgeLabel && (
      <span class={badgeClasses}>{badgeLabel}</span>
    )}
  </div>

  <div class="relative p-4 flex flex-col flex-grow">
    <div class="flex flex-col gap-2 flex-grow pb-12">
      <p class="text-xl font-bold text-slate-900">
        {title}
      </p>
    </div>

    <div class="absolute bottom-4 left-4 right-4 flex justify-between items-center">
      {
        hasFile ? (
          <HoverableLink href={fileUrl!} target="_blank">
            {t("download")}
          </HoverableLink>
        ) : (
          <span class="text-slate-400">{t("download")}</span>
        )
      }

      {hasFile && (
        <div class="flex items-center gap-2">
          <WhatsAppShare client:load shareData={{ url: fileUrl!, title }} />
          <ShareLink shareData={{ url: fileUrl!, title }} />
        </div>
      )}
    </div>
  </div>
</div>
