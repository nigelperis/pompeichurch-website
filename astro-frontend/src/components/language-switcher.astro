---
import { Locale } from "~/enums/locale";
import { Icon } from "astro-icon/components";

const currentLocale = Astro.currentLocale as Locale;
const currentPath = Astro.url.pathname;
const search = Astro.url.search;
const hash = Astro.url.hash;

const labels = { en: "English", kok: "ಕೊಂಕಣಿ" };
const isKok = currentLocale === Locale.KOK;
const currentKey = isKok ? "kok" : "en";
const otherKey = isKok ? "en" : "kok";
const currentLabel = labels[currentKey];
const switchLabel = labels[otherKey];

const switchPath = isKok
  ? currentPath.replace(/^\/kok/, "") || "/"
  : `/kok${currentPath}`;
const switchUrl = `${switchPath}${search}${hash}`;

const switchFont = isKok
  ? "'Roboto', sans-serif"
  : "'Noto Sans Kannada', sans-serif";
---

<div tabindex="0" class="relative inline-block group focus-within:block mx-auto">
  <button
    type="button"
    class="w-22 flex items-center justify-between border border-gray-300 px-2 py-2 font-semibold hover:bg-gray-100 transition-colors cursor-pointer"
  >
    <span
      class={`relative inline-block leading-none ${
        currentKey === "kok" ? "top-[3px]" : ""
      }`}
    >
      {currentLabel}
    </span>
    <Icon
      name="chevron-down"
      class={`inline-block h-5 w-5 align-middle ${
        currentKey === "kok" ? "scale-120" : ""
      }`}
    />
  </button>

  <ul
    class="hidden group-hover:block group-focus-within:block absolute inset-x-0 top-full w-full bg-white border border-gray-200 shadow-lg z-20"
  >
    <li>
      <a
        href={switchUrl}
        aria-label={`Switch to ${switchLabel}`}
        class="flex items-center justify-center px-2.5 py-2.5 hover:bg-gray-100 transition-colors"
      >
        <span
          style={`font-family: ${switchFont}`}
          class={`relative inline-block leading-none ${
            currentKey === "en" ? "top-[2px]" : ""
          }`}
        >
          {switchLabel}
        </span>
      </a>
    </li>
  </ul>
</div>

