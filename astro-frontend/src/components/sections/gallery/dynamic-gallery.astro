---
import type { GalleryAlbum } from "~/models/gallery";

export interface Props {
  albums: GalleryAlbum[];
}

const { albums } = Astro.props as Props;
---

<div class="w-full">
  <div class="masonry-grid relative m-4 mx-auto min-h-screen w-full" id="gallery-grid">
    {
      albums.flatMap((album) => (
        (album.images ?? []).map((img) => (
          <a
            href="#"
            role="button"
            aria-label="View full-size image"
            data-pswp-src={new URL(img.url, import.meta.env.PUBLIC_STRAPI_URL).toString()}
            data-pswp-width={String(img.width)}
            data-pswp-height={String(img.height)}
            class="masonry-grid-item-link masonry-grid-item inline-block w-1/2 lg:w-1/3"
          >
            <div class="relative overflow-hidden rounded-md md:p-1.5 p-1">
              <div class="img-hover-zoom img-hover-zoom--xyz relative w-full overflow-hidden">
                <img
                  src={new URL(
                    img.formats?.medium?.url ?? img.url,
                    import.meta.env.PUBLIC_STRAPI_URL,
                  ).toString()}
                  alt={img.alternativeText ?? album.name}
                  width={img.formats?.medium?.width ?? img.width}
                  height={img.formats?.medium?.height ?? img.height}
                  loading="lazy"
                  class="object-cover w-full h-full transition-transform duration-400 hover:scale-110"
                />
              </div>
            </div>
          </a>
        ))
      ))
    }
  </div>
</div>

<script>
  import { masonry } from "~/scripts/gallery-lightbox";
  masonry();
</script>
