---
import { Locale } from "~/enums/locale";
import { getLangFromUrl, useTranslations } from "~/i18n/utils";
import { cn } from "~/helpers/cn";
import NetworkImage from "~/components/ui/network-image.astro";
import type { Media } from "~/models/parish-pastoral-commission";
import { getPlaceholderImage } from "~/helpers/get-placeholder-image";

interface SubCommissions {
  title: string;
  secretary: string;
}

interface Props {
  title: string;
  noOfCommissions?: number;
  convenor: string;
  sexOfConvenor: string;
  imageOfConvenor?: Media;
  subCommissions: SubCommissions[];
}

const {
  title,
  noOfCommissions,
  convenor,
  sexOfConvenor,
  imageOfConvenor,
  subCommissions,
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
---

<div class="border border-gray-200 overflow-hidden">
  <div
    class="bg-linear-to-r from-yellow-50 to-yellow-50 border-b border-yellow-200 p-6"
  >
    <div class="flex items-start space-x-4">
      <div class="flex-1 min-w-0">
        <h3 class="text-2xl text-center font-bold leading-tight mb-6">
          {title}
          {noOfCommissions && Number(noOfCommissions) > 0 && `(${noOfCommissions})`}
        </h3>
        <div class="flex space-x-8 items-center">
          <div class="shrink-0">
            <NetworkImage
              src={imageOfConvenor?.url
                ? new URL(
                    imageOfConvenor?.url,
                    import.meta.env.PUBLIC_STRAPI_URL,
                  ).toString()
                : getPlaceholderImage({ text: convenor })}
              width={imageOfConvenor?.width || 600}
              height={imageOfConvenor?.height || 400}
              alt={convenor}
              class="w-24 h-24 rounded-full object-cover object-top"
            />
          </div>
          <div class="mt-3 flex flex-col space-x-2 gap-3">
            <span
              class={cn(
                "text-md font-medium text-yellow-700 bg-yellow-100 px-3 py-1 rounded-full",
                lang === Locale.KOK ? "font-noto-sans-kannada" : "font-roboto",
              )}
            >
              {
                sexOfConvenor ?
                  (lang === Locale.KOK
                    ? sexOfConvenor === "Female"
                      ? "ಸಂಚಾಲಕಿ"
                      : "ಸಂಚಾಲಕ್"
                    : "Convenor") : "Convenor"
              }
            </span>
            <span class="text-md text-slate-900 font-medium">
              {convenor}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="p-6">
    <div class="space-y-4">
      {
        subCommissions?.map((subCommission) => (
          <div class="group bg-gray-50 p-4">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
              <div class="flex-1">
                <h5 class="font-semibold text-slate-900 text-base leading-tight">
                  {subCommission.title}
                </h5>
              </div>
              <div class="flex items-center space-x-2 sm:shrink-0">
                <div class="flex items-center space-x-2">
                  <span class="text-sm text-gray-700 font-medium">
                    {subCommission.secretary}
                  </span>
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</div>
