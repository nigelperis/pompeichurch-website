---
import ObituaryListWithDetails from "~/components/ObituaryListWithDetails.tsx";
import { getLangFromUrl } from "~/i18n/utils";
import type { Obituary } from "~/models/obituary";

const { obituaries } = Astro.props as { obituaries: Obituary[] };
const lang = getLangFromUrl(Astro.url);
---

  <ObituaryListWithDetails
    obituaries={obituaries.map((o) => ({
      id: o.id,
      lang: o.lang || "en",
      englishName: o.englishName,
      konkaniName: o.konkaniName,
      image: o.image ?? null,
      age: o.age,
      relationType: o.relationType,
      relationNameEn: o.relationNameEn,
      relationNameKok: o.relationNameKok,
      ward: o.ward,
      dateOfDeath: !o.dateOfDeath
        ? undefined
        : typeof o.dateOfDeath === "string"
          ? o.dateOfDeath
          : typeof o.dateOfDeath === "object" &&
            o.dateOfDeath !== null &&
            typeof (o.dateOfDeath as any).toISOString === "function"
            ? (o.dateOfDeath as Date).toISOString().split("T")[0]
            : undefined,
      funeralDetails: o.funeralDetails,
    }))}
    lang={lang}
    client:load
  />
