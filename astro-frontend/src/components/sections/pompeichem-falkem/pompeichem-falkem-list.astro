---
import MagazineCard from "~/components/magazine-card.astro";
import type { PompeichemFalkem } from "~/models/pompeichem-falkem";
import { getPlaceholderImage } from "~/helpers/get-placeholder-image";
import { getLangFromUrl } from "~/i18n/utils";
import {
  getMagazineDisplayTitle,
  isSpecialEdition,
  isCentenaryEdition,
} from "~/helpers/magazine";

const {
  magazines,
  isFirstPage = false,
  latestMagazineId,
} = Astro.props as {
  magazines: PompeichemFalkem[];
  isFirstPage?: boolean;
  latestMagazineId?: number;
};

const lang = getLangFromUrl(Astro.url);

// Keep the incoming order from the page query (desc for default, asc for year filter)
const magazinesOrdered = magazines;
---

<div
  class="grid grid-cols-1 gap-10 lg:gap-x-20 lg:gap-y-20 md:grid-cols-2 lg:grid-cols-3"
>
  {
    magazinesOrdered.map((magazine, index) => {
      const isLatest =
        typeof latestMagazineId === "number"
          ? magazine.id === latestMagazineId
          : isFirstPage && index === 0;
      const isSpecial = isSpecialEdition(magazine);
      const isCentenary = isCentenaryEdition(magazine);
      const displayTitle = getMagazineDisplayTitle(magazine, lang);

      return (
        <div class="h-full">
          <MagazineCard
            title={displayTitle}
            imageUrl={
              magazine.coverImage?.url
                ? new URL(
                    magazine.coverImage.url,
                    import.meta.env.PUBLIC_STRAPI_URL,
                  ).toString()
                : getPlaceholderImage({
                    text: displayTitle,
                    width: magazine.coverImage?.width ?? 400,
                    height: magazine.coverImage?.height ?? 500,
                  })
            }
            imageWidth={magazine.coverImage?.width ?? 400}
            imageHeight={magazine.coverImage?.height ?? 500}
            fileUrl={
              magazine.pdfFile?.url
                ? new URL(
                    magazine.pdfFile.url,
                    import.meta.env.PUBLIC_STRAPI_URL,
                  ).toString()
                : null
            }
            dateOfPublish={magazine.dateOfPublish}
            latest={isLatest}
            specialEdition={isSpecial}
            centenaryEdition={isCentenary}
          />
        </div>
      );
    })
  }
</div>
